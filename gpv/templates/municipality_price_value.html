{% extends "base.html" %}
{% block body %}
<script type=text/javascript>
	google.load("visualization", "1", {packages:["corechart"]});
	$(document).ready(function(){
      //draw chart on load
      drawContractValueChart("Vlera e kontratave krahasuar me komunat e ndryshme", "vlera");

      //binding the chart on vleracmimi-select index change
      $('#vleracmimi-select').change(function(){
        var selected = $('#vleracmimi-select').val();
        var selected_VC = capitaliseFirstLetter(selected);
        if (selected != 'numriKontratave'){
          var title = selected_VC + " kontratave krahasuar me komunat e ndryshme";
        	drawContractValueChart(title, selected);
        }else{
          var title = "Numri i Kontratave krahasuar me komunat e ndryshme";
          drawContractValueChart(title, selected);
        }
      });

      //binding the chart on viti-select index change
      $('#viti-select').change(function(){
        var selected = $('#vleracmimi-select').val();
        var selected_VC = capitaliseFirstLetter(selected);
        var title = selected_VC + " kontratave krahasuar me komunat e ndryshme";
        drawContractValueChart(title, selected);
      });
	})

  //creating a function that draws the chart.
	function drawContractValueChart(title, param) {
        var viti = $('#viti-select').val();
        var url = '{{ config.BASE_PATH }}/json/monthly-summary/'+ viti;
        $.get(url, function(resultJson){
            var data = google.visualization.arrayToDataTable([
              ['Muji'],
              ["Janar"],
              ["Shkurt"],
              ["Mars"],
              ["Prill"],
              ["Maj"],
              ["Qershor"],
              ["Korrik"],
              ["Gusht"],
              ["Shtator"],
              ["Tetor"],
              ["Nëntor"],
              ["Dhjetor"]
            ]);


            var currentCity = '';
            var columnIndex = 0;

            for (var key in resultJson ){
              if (resultJson[key].komuna != currentCity){
                	data.addColumn('number', resultJson[key].komuna);
                	currentCity = resultJson[key].komuna;
                	columnIndex++;
              }
              data.setCell(resultJson[key].muaji-1, columnIndex, resultJson[key][param]);
            }

            var options = {
              'title': title,
              'width':1000,
              'height':600,
              'vAxis': {
                'title': 'Vlerat'
              },
              'hAxis': {
                'title': 'Muaji'
              }
            };

            var formatter = new google.visualization.NumberFormat({
                      fractionDigits: 0,
                      prefix: '€ '
              });

              if( param != 'numriKontratave'){
                for(var i=1; i <= 3; i++){
                  formatter.format(data, i);
                }
              }

            var chart = new google.visualization.LineChart(document.getElementById('lineChart'));

            chart.draw(data, options);

        })
      };

      //Creating a function that convert the first characted of a string to uppercase
      function capitaliseFirstLetter(string){
        if(string != "qmimi"){
          return string.charAt(0).toUpperCase() + string.slice(1);
        }
        else{
          return string.replace('q','Ç');
        }
      }
</script>
<div id="select" style="margin-left:350px;">
  <form class="form-inline">
      <div class="form-group">
          <label>Viti: </label>
      </div>
      <div class="form-group">
          <select id="viti-select" class="form-control">
              <option value="2011">2011</option>
              <option value="2012">2012</option>
              <option value="2013" selected="selected">2013</option>
          </select>
      </div>
      <div class="form-group" style="margin-left:10px;">
          <label>Zgjidhja: </label>
      </div>
      <div class="form-group">
        <select id="vleracmimi-select" class="form-control">
          <option selected="selected" value="vlera">Vlera</option>
          <option value="qmimi">Çmimi</option>
          <option value="numriKontratave">Numri i Kontratave</option>
         </select>
      </div>
  </form>
</div>

<div id="lineChart">
</div>

{% endblock %}